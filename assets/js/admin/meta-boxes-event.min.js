!function(e){"use strict";var t={init:function(){e("#location_event_details").on("change","select#_event_location_select",this.addLocation).on("click",".location .top-bar .actions .remove",this.removeLocation).on("click",".location .top-bar",this.toggleEdit).on("click",".location .edit-wrapper .save",this.saveLocation).on("click",".location .edit-wrapper .delete",this.deleteLocation).on("saving-location",this.addLoading).on("location-saved",this.updateLocation),e(document).ready(function(){e("#_event_location").val()&&e("#location_event_details").trigger("update-location")})},addLocation:function(){var t=e(this).find(":selected").data("id");e("#_event_location").val(t),e("#location_event_details").trigger("update-location")},toggleEdit:function(t){t.preventDefault(),e(this).parents(".location").find(".edit-wrapper").slideToggle()},removeLocation:function(t){void 0!==t&&t.preventDefault(),e("#_event_location").val(""),e("#_event_location_select").val(""),e("#location-list-wrapper").empty()},saveLocation:function(t){t.preventDefault(),e("#location_event_details").trigger("saving-location");var a=e(this).parents(".location"),n=[{id:a.data("id"),title:a.find('input[name="location_title"]').val(),address:a.find('input[name="location_address"]').val(),city:a.find('input[name="location_city"]').val(),postcode:a.find('input[name="location_postcode"]').val(),county:a.find('input[name="location_county"]').val(),country:a.find('input[name="location_country"]').val()}];e("#location_event_details").trigger("save-location",n)},deleteLocation:function(a){a.preventDefault();var n=e(this).parents(".location").data("id");0!==n&&window.confirm("Are you sure you want to delete this location from all events?")&&(t.removeLocation(),e("#location_event_details").trigger("delete-location",n))},addLoading:function(){e("#location-list-wrapper").addClass("loading"),e("#location-list-wrapper .location .edit-wrapper .small-error").remove()},updateLocation:function(t,a){e("#location-list-wrapper").removeClass("loading"),0!==a.location.id&&(e("#_event_location_select").replaceWith(a.selectHtml),e("#_event_location").val(a.location.id),e("#_event_location_select").val(a.location.id)),e("#location_event_details").trigger("update-location")}},a={init:function(){e("#location_event_details").on("update-location",this.updateLocation).on("save-location",this.saveLocation).on("delete-location",this.deleteLocation)},updateLocation:function(){e("#location-list-wrapper").addClass("loading"),e.ajax({url:pe_admin_meta_boxes_event.ajax_url,data:{action:"press_events_get_location",security:pe_admin_meta_boxes_event.get_location_nonce,event_location_id:e("#_event_location").val()},type:"POST",success:function(t){e("#location-list-wrapper").removeClass("loading"),e("#location-list-wrapper").empty(),e("#location-list-wrapper").append([t.data].map(function(t){return e('script[data-template="location-item"]').text().split(/\$\{(.+?)\}/g).map(a.render(t)).join("")})),0===t.data.id?e('#location-list-wrapper .location[data-id="0"] .edit-wrapper').slideToggle():e("#_event_location_select").val(t.data.id)}})},saveLocation:function(t,n){e("#location-list-wrapper").addClass("loading"),e.ajax({url:pe_admin_meta_boxes_event.ajax_url,data:{action:"press_events_update_location",security:pe_admin_meta_boxes_event.update_location_nonce,data:n},type:"POST",success:function(t){t.success?e("#location_event_details").trigger("location-saved",t.data):(e("#location-list-wrapper").removeClass("loading"),e("#location-list-wrapper .location .edit-wrapper").prepend([{error:t.data}].map(function(t){return e('script[data-template="location-error"]').text().split(/\$\{(.+?)\}/g).map(a.render(t)).join("")})))}})},deleteLocation:function(t,a){e.ajax({url:pe_admin_meta_boxes_event.ajax_url,data:{action:"press_events_delete_location",security:pe_admin_meta_boxes_event.delete_location_nonce,location_id:a},type:"POST",success:function(t){e("#_event_location_select").find('option[value="'+t.data+'"]').remove(),e("#location_event_details").trigger("location-deleted",t.data)}})},render:function(e){return function(t,a){return a%2?e[t]:t}}},n={init:function(){this.sortable(),e("#organiser_event_details").on("change","select#_event_organiser_select",this.addOrganiser).on("click",".organiser .top-bar",this.toggleEdit).on("click",".organiser .top-bar .actions .remove",this.removeOrganiser).on("click",".organiser .edit-wrapper .save",this.saveOrganiser).on("saving-organiser",this.addLoading),e(document).ready(function(){e("#_event_organisers").val()&&e("#organiser_event_details").trigger("update-organisers")})},sortable:function(){e("#organisers-drag-drop-wrapper").sortable({placeholder:"ui-state-highlight",handle:".drag",update:function(){n.updateOrder()},stop:function(){n.mainOrganiserFlag()}})},mainOrganiserFlag:function(){var t=e("#organisers-drag-drop-wrapper .organiser").length;e("#organisers-drag-drop-wrapper .organiser .top-bar .main").removeClass("active"),t>1&&e("#organisers-drag-drop-wrapper .organiser:first-child .top-bar .main").addClass("active")},updateOrder:function(){var t=[];e("#organisers-drag-drop-wrapper .organiser").each(function(){t.push(e(this).data("id"))});var a=t.join(",");e("input#_event_organisers").val(a)},addOrganiser:function(t,a){void 0===a&&(a=e(this).find(":selected").data("id"));var n=e("#_event_organisers").val();(n=""===n?[]:n.split(",")).push(a),e("#_event_organisers").val(n.join(",")),e("#organiser_event_details").trigger("update-organisers")},toggleEdit:function(t){t.preventDefault(),e(this).parents(".organiser").find(".edit-wrapper").slideToggle()},hideEdit:function(t){t.preventDefault(),e(this).parents(".organiser").find(".edit-wrapper").hide()},removeOrganiser:function(t,a){void 0!==t&&t.preventDefault(),void 0===a&&(a=e(this).parents(".organiser").data("id")),e(this).parents(".organiser").remove();var n=e("#_event_organisers").val();n=""===n?[]:n.split(","),n=e.grep(n,function(e){return e!=a}),e("#_event_organisers").val(n.join(",")),e("#organiser_event_details").trigger("update-organisers")},saveOrganiser:function(t){t.preventDefault(),e("#organiser_event_details").trigger("saving-organiser");var a=e(this).parents(".organiser"),n={id:a.data("id"),display_name:a.find('input[name="display_name"]').val(),user_email:a.find('input[name="user_email"]').val(),user_url:a.find('input[name="user_url"]').val(),user_phone:a.find('input[name="user_phone"]').val()};e("#organiser_event_details").trigger("save-organiser",[{organiser:n,$el:a}])},addLoading:function(){e("#organisers-drag-drop-wrapper").addClass("loading"),e("#organisers-drag-drop-wrapper .organiser .edit-wrapper .small-error").remove()}},i={init:function(){e("#organiser_event_details").on("update-organisers",this.updateOrganisers).on("save-organiser",this.saveOrganiser)},updateOrganisers:function(){e.ajax({url:pe_admin_meta_boxes_event.ajax_url,data:{action:"press_events_get_organisers",security:pe_admin_meta_boxes_event.get_organisers_nonce,event_organiser_ids:e("#_event_organisers").val()},type:"POST",success:function(t){e("#organisers-drag-drop-wrapper").empty(),e.each(t.data.organisers,function(t,a){e("#organisers-drag-drop-wrapper").append([a].map(function(t){return e('script[data-template="organiser-item"]').text().split(/\$\{(.+?)\}/g).map(i.render(t)).join("")}))}),e("#organisers-drag-drop-wrapper").find('.organiser[data-id="0"] .top-bar').trigger("click"),e("#_event_organisers").val(t.data.ids),n.mainOrganiserFlag(),e("#_event_organiser_select").val("")}})},saveOrganiser:function(t,a){e.ajax({url:pe_admin_meta_boxes_event.ajax_url,data:{action:"press_events_update_organiser",security:pe_admin_meta_boxes_event.update_organiser_nonce,data:a.organiser},type:"POST",success:function(o){o.success?(e("#_event_organiser_select").replaceWith(o.data.selectHtml),e("#organisers-drag-drop-wrapper").removeClass("loading"),0===a.organiser.id&&n.removeOrganiser(t,0),n.addOrganiser(t,o.data.organiser.ID)):(e("#organisers-drag-drop-wrapper").removeClass("loading"),a.$el.find(".edit-wrapper").prepend([{error:o.data}].map(function(t){return e('script[data-template="organiser-error"]').text().split(/\$\{(.+?)\}/g).map(i.render(t)).join("")})))}})},render:function(e){return function(t,a){return a%2?e[t]:t}}};({init:function(){this.loadPickers(),e("#press-events-event-details").on("change","input#_all_day_event",this.onlyShowTime).on("change","input.date",this.syncPickers).on("click","input.visible-date",this.showPicker).on("click","a#timezone-toggle",this.showTimezoneInput),e("input#_all_day_event").change()},loadPickers:function(){e("#date_time_event_details .date").datepicker({autoclose:!0,format:"yyyy-mm-dd",container:"#date_time_event_details"}),e("#date_time_event_details .time").timepicker({showDuration:!0,timeFormat:pe_admin_meta_boxes_event.time_format}),e("#date_time_event_details").datepair()},syncPickers:function(){var t=new DateFormatter({dateSettings:{days:pe_admin_meta_boxes_event.date_vars.days,daysShort:pe_admin_meta_boxes_event.date_vars.daysShort,monthsShort:pe_admin_meta_boxes_event.date_vars.monthsShort,months:pe_admin_meta_boxes_event.date_vars.months,meridiem:pe_admin_meta_boxes_event.date_vars.meridiem,ordinal:function(e){var t=e%10,a={1:"st",2:"nd",3:"rd"};return 1!==Math.floor(e%100/10)&&a[t]?a[t]:"th"}}});e("#press-events-event-details .date").each(function(){e("#"+e(this).data("input-mask")).val(t.formatDate(e(this).datepicker("getDate"),pe_admin_meta_boxes_event.date_format))})},showPicker:function(){e("#"+e(this).data("datepicker")).datepicker("show")},onlyShowTime:function(){this.checked?e("#date_time_event_details .time").hide():e("#date_time_event_details .time").show()},showTimezoneInput:function(){e(".field-wrapper.event-timezone").addClass("active-edit")}}).init(),t.init(),a.init(),n.init(),i.init()}(jQuery);